{"ast":null,"code":"var _jsxFileName = \"/home/spren/workspace/kitties-front-end/src/substrate-lib/components/TxButton.js\",\n    _s = $RefreshSig$();\n\nimport React, { useState, useEffect } from 'react';\nimport PropTypes from 'prop-types';\nimport { Button } from 'semantic-ui-react';\nimport { web3FromSource } from '@polkadot/extension-dapp';\nimport { useSubstrate } from '../';\nimport utils from '../utils';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nfunction TxButton({\n  accountPair = null,\n  label,\n  setStatus,\n  color = 'blue',\n  style = null,\n  type = 'QUERY',\n  attrs = null,\n  onClick = null,\n  disabled = false\n}) {\n  _s();\n\n  // Hooks\n  const {\n    api\n  } = useSubstrate();\n  const [unsub, setUnsub] = useState(null);\n  const [sudoKey, setSudoKey] = useState(null);\n  const {\n    palletRpc,\n    callable,\n    inputParams,\n    paramFields\n  } = attrs;\n\n  const isQuery = () => type === 'QUERY';\n\n  const isSudo = () => type === 'SUDO-TX';\n\n  const isUncheckedSudo = () => type === 'UNCHECKED-SUDO-TX';\n\n  const isUnsigned = () => type === 'UNSIGNED-TX';\n\n  const isSigned = () => type === 'SIGNED-TX';\n\n  const isRpc = () => type === 'RPC';\n\n  const isConstant = () => type === 'CONSTANT';\n\n  const loadSudoKey = () => {\n    (async function () {\n      if (!api || !api.query.sudo) {\n        return;\n      }\n\n      const sudoKey = await api.query.sudo.key();\n      sudoKey.isEmpty ? setSudoKey(null) : setSudoKey(sudoKey.toString());\n    })();\n  };\n\n  useEffect(loadSudoKey, [api]);\n\n  const getFromAcct = async () => {\n    const {\n      address,\n      meta: {\n        source,\n        isInjected\n      }\n    } = accountPair;\n    let fromAcct; // signer is from Polkadot-js browser extension\n\n    if (isInjected) {\n      const injected = await web3FromSource(source);\n      fromAcct = address;\n      api.setSigner(injected.signer);\n    } else {\n      fromAcct = accountPair;\n    }\n\n    return fromAcct;\n  };\n\n  const txResHandler = ({\n    status\n  }) => status.isFinalized ? setStatus(`ðŸ˜‰ Finalized. Block hash: ${status.asFinalized.toString()}`) : setStatus(`Current transaction status: ${status.type}`);\n\n  const txErrHandler = err => setStatus(`ðŸ˜ž Transaction Failed: ${err.toString()}`);\n\n  const sudoTx = async () => {\n    const fromAcct = await getFromAcct();\n    const transformed = transformParams(paramFields, inputParams);\n    const txExecute = transformed ? api.tx.sudo.sudo(api.tx[palletRpc][callable](...transformed)) : api.tx.sudo.sudo(api.tx[palletRpc][callable]());\n    const unsub = txExecute.signAndSend(fromAcct, txResHandler).catch(txErrHandler); // note: you cannot store a function directly in React state hook. You need to wrap it in\n    //   anonymous function. See: https://bit.ly/30hbINF\n\n    setUnsub(() => unsub);\n  };\n\n  const uncheckedSudoTx = async () => {\n    const fromAcct = await getFromAcct();\n    const txExecute = api.tx.sudo.sudoUncheckedWeight(api.tx[palletRpc][callable](...inputParams), 0);\n    const unsub = txExecute.signAndSend(fromAcct, txResHandler).catch(txErrHandler);\n    setUnsub(() => unsub);\n  };\n\n  const signedTx = async () => {\n    const fromAcct = await getFromAcct();\n    const transformed = transformParams(paramFields, inputParams);\n    const txExecute = transformed ? api.tx[palletRpc][callable](...transformed) : api.tx[palletRpc][callable]();\n    const unsub = await txExecute.signAndSend(fromAcct, txResHandler).catch(txErrHandler);\n    setUnsub(() => unsub);\n  };\n\n  const unsignedTx = async () => {\n    const transformed = transformParams(paramFields, inputParams);\n    const txExecute = transformed ? api.tx[palletRpc][callable](...transformed) : api.tx[palletRpc][callable]();\n    const unsub = await txExecute.send(txResHandler).catch(txErrHandler);\n    setUnsub(() => unsub);\n  };\n\n  const queryResHandler = result => result.isNone ? setStatus('None') : setStatus(result.toString());\n\n  const query = async () => {\n    const transformed = transformParams(paramFields, inputParams);\n    const unsub = await api.query[palletRpc][callable](...transformed, queryResHandler);\n    setUnsub(() => unsub);\n  };\n\n  const rpc = async () => {\n    const transformed = transformParams(paramFields, inputParams, {\n      emptyAsNull: false\n    });\n    const unsub = await api.rpc[palletRpc][callable](...transformed, queryResHandler);\n    setUnsub(() => unsub);\n  };\n\n  const constant = () => {\n    const result = api.consts[palletRpc][callable];\n    result.isNone ? setStatus('None') : setStatus(result.toString());\n  };\n\n  const transaction = async () => {\n    if (unsub) {\n      unsub();\n      setUnsub(null);\n    }\n\n    setStatus('Sending...');\n    isSudo() && sudoTx() || isUncheckedSudo() && uncheckedSudoTx() || isSigned() && signedTx() || isUnsigned() && unsignedTx() || isQuery() && query() || isRpc() && rpc() || isConstant() && constant();\n  }; // notes: If onClick handler is passed in, we want to call it. But we want call the handler\n  //   only when the unsubscription handler (unsub) is ready, so we can pass the unsub handler to\n  //   the onClick handler for processing. Thus we use a `useEffect` here.\n\n\n  useEffect(() => {\n    if (unsub && onClick) {\n      onClick(unsub);\n      setUnsub(null);\n    }\n  }, [unsub, onClick]);\n\n  const transformParams = (paramFields, inputParams, opts = {\n    emptyAsNull: true\n  }) => {\n    // if `opts.emptyAsNull` is true, empty param value will be added to res as `null`.\n    //   Otherwise, it will not be added\n    const paramVal = inputParams.map(inputParam => {\n      // To cater the js quirk that `null` is a type of `object`.\n      if (typeof inputParam === 'object' && inputParam !== null && typeof inputParam.value === 'string') {\n        return inputParam.value.trim();\n      } else if (typeof inputParam === 'string') {\n        return inputParam.trim();\n      }\n\n      return inputParam;\n    });\n    const params = paramFields.map((field, ind) => ({ ...field,\n      value: typeof paramVal[ind] === 'undefined' ? null : paramVal[ind]\n    }));\n    return params.reduce((memo, {\n      type = 'string',\n      value\n    }) => {\n      if (value == null || value === '') return opts.emptyAsNull ? [...memo, null] : memo;\n      let converted = value; // Deal with a vector\n\n      if (type.indexOf('Vec<') >= 0) {\n        converted = converted.split(',').map(e => e.trim());\n        converted = converted.map(single => isNumType(type) ? single.indexOf('.') >= 0 ? Number.parseFloat(single) : Number.parseInt(single) : single);\n        return [...memo, converted];\n      } // Deal with a single value\n\n\n      if (isNumType(type)) {\n        converted = converted.indexOf('.') >= 0 ? Number.parseFloat(converted) : Number.parseInt(converted);\n      }\n\n      return [...memo, converted];\n    }, []);\n  };\n\n  const isNumType = type => utils.paramConversion.num.some(el => type.indexOf(el) >= 0);\n\n  const allParamsFilled = () => {\n    if (paramFields.length === 0) {\n      return true;\n    }\n\n    return paramFields.every((paramField, ind) => {\n      const param = inputParams[ind];\n\n      if (paramField.optional) {\n        return true;\n      }\n\n      if (param == null) {\n        return false;\n      }\n\n      const value = typeof param === 'object' ? param.value : param;\n      return value !== null && value !== '';\n    });\n  };\n\n  const isSudoer = acctPair => {\n    if (!sudoKey || !acctPair) {\n      return false;\n    }\n\n    return acctPair.address === sudoKey;\n  };\n\n  return /*#__PURE__*/_jsxDEV(Button, {\n    basic: true,\n    color: color,\n    style: style,\n    type: \"submit\",\n    onClick: transaction,\n    disabled: disabled || !palletRpc || !callable || !allParamsFilled() || (isSudo() || isUncheckedSudo()) && !isSudoer(accountPair),\n    children: label\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 227,\n    columnNumber: 5\n  }, this);\n} // prop type checking\n\n\n_s(TxButton, \"TNVI1DLdJhJlD/mjX2rR/nM1kko=\", false, function () {\n  return [useSubstrate];\n});\n\n_c = TxButton;\nTxButton.propTypes = {\n  accountPair: PropTypes.object,\n  setStatus: PropTypes.func.isRequired,\n  onClick: PropTypes.func,\n  type: PropTypes.oneOf(['QUERY', 'RPC', 'SIGNED-TX', 'UNSIGNED-TX', 'SUDO-TX', 'UNCHECKED-SUDO-TX', 'CONSTANT']).isRequired,\n  attrs: PropTypes.shape({\n    palletRpc: PropTypes.string,\n    callable: PropTypes.string,\n    inputParams: PropTypes.array,\n    paramFields: PropTypes.array\n  }).isRequired\n};\n\nfunction TxGroupButton(props) {\n  return /*#__PURE__*/_jsxDEV(Button.Group, {\n    children: [/*#__PURE__*/_jsxDEV(TxButton, {\n      label: \"Unsigned\",\n      type: \"UNSIGNED-TX\",\n      color: \"grey\",\n      ...props\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 260,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Button.Or, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 266,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(TxButton, {\n      label: \"Signed\",\n      type: \"SIGNED-TX\",\n      color: \"blue\",\n      ...props\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 267,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Button.Or, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 273,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(TxButton, {\n      label: \"SUDO\",\n      type: \"SUDO-TX\",\n      color: \"red\",\n      ...props\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 274,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 259,\n    columnNumber: 5\n  }, this);\n}\n\n_c2 = TxGroupButton;\nexport { TxButton, TxGroupButton };\n\nvar _c, _c2;\n\n$RefreshReg$(_c, \"TxButton\");\n$RefreshReg$(_c2, \"TxGroupButton\");","map":{"version":3,"sources":["/home/spren/workspace/kitties-front-end/src/substrate-lib/components/TxButton.js"],"names":["React","useState","useEffect","PropTypes","Button","web3FromSource","useSubstrate","utils","TxButton","accountPair","label","setStatus","color","style","type","attrs","onClick","disabled","api","unsub","setUnsub","sudoKey","setSudoKey","palletRpc","callable","inputParams","paramFields","isQuery","isSudo","isUncheckedSudo","isUnsigned","isSigned","isRpc","isConstant","loadSudoKey","query","sudo","key","isEmpty","toString","getFromAcct","address","meta","source","isInjected","fromAcct","injected","setSigner","signer","txResHandler","status","isFinalized","asFinalized","txErrHandler","err","sudoTx","transformed","transformParams","txExecute","tx","signAndSend","catch","uncheckedSudoTx","sudoUncheckedWeight","signedTx","unsignedTx","send","queryResHandler","result","isNone","rpc","emptyAsNull","constant","consts","transaction","opts","paramVal","map","inputParam","value","trim","params","field","ind","reduce","memo","converted","indexOf","split","e","single","isNumType","Number","parseFloat","parseInt","paramConversion","num","some","el","allParamsFilled","length","every","paramField","param","optional","isSudoer","acctPair","propTypes","object","func","isRequired","oneOf","shape","string","array","TxGroupButton","props"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react'\nimport PropTypes from 'prop-types'\nimport { Button } from 'semantic-ui-react'\nimport { web3FromSource } from '@polkadot/extension-dapp'\n\nimport { useSubstrate } from '../'\nimport utils from '../utils'\n\nfunction TxButton ({\n  accountPair = null,\n  label,\n  setStatus,\n  color = 'blue',\n  style = null,\n  type = 'QUERY',\n  attrs = null,\n  onClick = null,\n  disabled = false\n}) {\n  // Hooks\n  const { api } = useSubstrate()\n  const [unsub, setUnsub] = useState(null)\n  const [sudoKey, setSudoKey] = useState(null)\n\n  const { palletRpc, callable, inputParams, paramFields } = attrs\n\n  const isQuery = () => type === 'QUERY'\n  const isSudo = () => type === 'SUDO-TX'\n  const isUncheckedSudo = () => type === 'UNCHECKED-SUDO-TX'\n  const isUnsigned = () => type === 'UNSIGNED-TX'\n  const isSigned = () => type === 'SIGNED-TX'\n  const isRpc = () => type === 'RPC'\n  const isConstant = () => type === 'CONSTANT'\n\n  const loadSudoKey = () => {\n    (async function () {\n      if (!api || !api.query.sudo) { return }\n      const sudoKey = await api.query.sudo.key()\n      sudoKey.isEmpty ? setSudoKey(null) : setSudoKey(sudoKey.toString())\n    })()\n  }\n\n  useEffect(loadSudoKey, [api])\n\n  const getFromAcct = async () => {\n    const {\n      address,\n      meta: { source, isInjected }\n    } = accountPair\n    let fromAcct\n\n    // signer is from Polkadot-js browser extension\n    if (isInjected) {\n      const injected = await web3FromSource(source)\n      fromAcct = address\n      api.setSigner(injected.signer)\n    } else {\n      fromAcct = accountPair\n    }\n\n    return fromAcct\n  }\n\n  const txResHandler = ({ status }) =>\n    status.isFinalized\n      ? setStatus(`ðŸ˜‰ Finalized. Block hash: ${status.asFinalized.toString()}`)\n      : setStatus(`Current transaction status: ${status.type}`)\n\n  const txErrHandler = err =>\n    setStatus(`ðŸ˜ž Transaction Failed: ${err.toString()}`)\n\n  const sudoTx = async () => {\n    const fromAcct = await getFromAcct()\n    const transformed = transformParams(paramFields, inputParams)\n    const txExecute = transformed\n      ? api.tx.sudo.sudo(api.tx[palletRpc][callable](...transformed))\n      : api.tx.sudo.sudo(api.tx[palletRpc][callable]())\n\n    const unsub = txExecute.signAndSend(fromAcct, txResHandler)\n      .catch(txErrHandler)\n    // note: you cannot store a function directly in React state hook. You need to wrap it in\n    //   anonymous function. See: https://bit.ly/30hbINF\n    setUnsub(() => unsub)\n  }\n\n  const uncheckedSudoTx = async () => {\n    const fromAcct = await getFromAcct()\n    const txExecute =\n      api.tx.sudo.sudoUncheckedWeight(api.tx[palletRpc][callable](...inputParams), 0)\n\n    const unsub = txExecute.signAndSend(fromAcct, txResHandler)\n      .catch(txErrHandler)\n    setUnsub(() => unsub)\n  }\n\n  const signedTx = async () => {\n    const fromAcct = await getFromAcct()\n    const transformed = transformParams(paramFields, inputParams)\n\n    const txExecute = transformed\n      ? api.tx[palletRpc][callable](...transformed)\n      : api.tx[palletRpc][callable]()\n\n    const unsub = await txExecute.signAndSend(fromAcct, txResHandler)\n      .catch(txErrHandler)\n    setUnsub(() => unsub)\n  }\n\n  const unsignedTx = async () => {\n    const transformed = transformParams(paramFields, inputParams)\n    const txExecute = transformed\n      ? api.tx[palletRpc][callable](...transformed)\n      : api.tx[palletRpc][callable]()\n\n    const unsub = await txExecute.send(txResHandler)\n      .catch(txErrHandler)\n    setUnsub(() => unsub)\n  }\n\n  const queryResHandler = result =>\n    result.isNone ? setStatus('None') : setStatus(result.toString())\n\n  const query = async () => {\n    const transformed = transformParams(paramFields, inputParams)\n    const unsub = await api.query[palletRpc][callable](...transformed, queryResHandler)\n    setUnsub(() => unsub)\n  }\n\n  const rpc = async () => {\n    const transformed = transformParams(paramFields, inputParams, { emptyAsNull: false })\n    const unsub = await api.rpc[palletRpc][callable](...transformed, queryResHandler)\n    setUnsub(() => unsub)\n  }\n\n  const constant = () => {\n    const result = api.consts[palletRpc][callable]\n    result.isNone ? setStatus('None') : setStatus(result.toString())\n  }\n\n  const transaction = async () => {\n    if (unsub) {\n      unsub()\n      setUnsub(null)\n    }\n\n    setStatus('Sending...');\n\n    (isSudo() && sudoTx()) ||\n    (isUncheckedSudo() && uncheckedSudoTx()) ||\n    (isSigned() && signedTx()) ||\n    (isUnsigned() && unsignedTx()) ||\n    (isQuery() && query()) ||\n    (isRpc() && rpc()) ||\n    (isConstant() && constant())\n  }\n\n  // notes: If onClick handler is passed in, we want to call it. But we want call the handler\n  //   only when the unsubscription handler (unsub) is ready, so we can pass the unsub handler to\n  //   the onClick handler for processing. Thus we use a `useEffect` here.\n  useEffect(() => {\n    if (unsub && onClick) {\n      onClick(unsub)\n      setUnsub(null)\n    }\n  }, [unsub, onClick])\n\n  const transformParams = (paramFields, inputParams, opts = { emptyAsNull: true }) => {\n    // if `opts.emptyAsNull` is true, empty param value will be added to res as `null`.\n    //   Otherwise, it will not be added\n    const paramVal = inputParams.map(inputParam => {\n      // To cater the js quirk that `null` is a type of `object`.\n      if (typeof inputParam === 'object' && inputParam !== null && typeof inputParam.value === 'string') {\n        return inputParam.value.trim()\n      } else if (typeof inputParam === 'string') {\n        return inputParam.trim()\n      }\n      return inputParam\n    })\n    const params = paramFields.map((field, ind) =>\n      ({ ...field, value: typeof paramVal[ind] === 'undefined' ? null : paramVal[ind] }))\n\n    return params.reduce((memo, { type = 'string', value }) => {\n      if (value == null || value === '') return (opts.emptyAsNull ? [...memo, null] : memo)\n\n      let converted = value\n\n      // Deal with a vector\n      if (type.indexOf('Vec<') >= 0) {\n        converted = converted.split(',').map(e => e.trim())\n        converted = converted.map(single => isNumType(type)\n          ? (single.indexOf('.') >= 0 ? Number.parseFloat(single) : Number.parseInt(single))\n          : single\n        )\n        return [...memo, converted]\n      }\n\n      // Deal with a single value\n      if (isNumType(type)) {\n        converted = converted.indexOf('.') >= 0 ? Number.parseFloat(converted) : Number.parseInt(converted)\n      }\n      return [...memo, converted]\n    }, [])\n  }\n\n  const isNumType = type =>\n    utils.paramConversion.num.some(el => type.indexOf(el) >= 0)\n\n  const allParamsFilled = () => {\n    if (paramFields.length === 0) { return true }\n\n    return paramFields.every((paramField, ind) => {\n      const param = inputParams[ind]\n      if (paramField.optional) { return true }\n      if (param == null) { return false }\n\n      const value = typeof param === 'object' ? param.value : param\n      return value !== null && value !== ''\n    })\n  }\n\n  const isSudoer = acctPair => {\n    if (!sudoKey || !acctPair) { return false }\n    return acctPair.address === sudoKey\n  }\n\n  return (\n    <Button\n      basic\n      color={color}\n      style={style}\n      type='submit'\n      onClick={transaction}\n      disabled={ disabled || !palletRpc || !callable || !allParamsFilled() ||\n        ((isSudo() || isUncheckedSudo()) && !isSudoer(accountPair)) }\n    >\n      {label}\n    </Button>\n  )\n}\n\n// prop type checking\nTxButton.propTypes = {\n  accountPair: PropTypes.object,\n  setStatus: PropTypes.func.isRequired,\n  onClick: PropTypes.func,\n  type: PropTypes.oneOf([\n    'QUERY', 'RPC', 'SIGNED-TX', 'UNSIGNED-TX', 'SUDO-TX', 'UNCHECKED-SUDO-TX',\n    'CONSTANT']).isRequired,\n  attrs: PropTypes.shape({\n    palletRpc: PropTypes.string,\n    callable: PropTypes.string,\n    inputParams: PropTypes.array,\n    paramFields: PropTypes.array\n  }).isRequired\n}\n\nfunction TxGroupButton (props) {\n  return (\n    <Button.Group>\n      <TxButton\n        label='Unsigned'\n        type='UNSIGNED-TX'\n        color='grey'\n        {...props}\n      />\n      <Button.Or />\n      <TxButton\n        label='Signed'\n        type='SIGNED-TX'\n        color='blue'\n        {...props}\n      />\n      <Button.Or />\n      <TxButton\n        label='SUDO'\n        type='SUDO-TX'\n        color='red'\n        {...props}\n      />\n    </Button.Group>\n  )\n}\n\nexport { TxButton, TxGroupButton }\n"]},"metadata":{},"sourceType":"module"}